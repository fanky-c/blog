<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <!--  禁止百度引擎抓取 -->
    <meta name="Baiduspider" content="noarchive">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="js、nodejs、css、nginx、vue、react">
    <meta name="keyword" content="网易">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        从web前端看macOs开发 - fanky_c的博客 | fanky_c&#39;s Blog
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i>  </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar">
            <img src="/img/avatar.jpg" />
        </div>
        <div class="name">
            <i>fanky_c</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Native与webview交互"><span class="toc-text">1: Native与webview交互</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#A-Native取得window对象"><span class="toc-text">A:Native取得window对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#B-Native调用JavaScript-Function"><span class="toc-text">B:Native调用JavaScript Function</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#js调用Native"><span class="toc-text">js调用Native</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Native调用js"><span class="toc-text">Native调用js</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#C-Native操作DOM"><span class="toc-text">C:Native操作DOM</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Native和web页面jsbridge通信"><span class="toc-text">2:Native和web页面jsbridge通信</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#原理"><span class="toc-text">原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#工作流"><span class="toc-text">工作流</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#用法"><span class="toc-text">用法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Native和web本地缓存数据区别"><span class="toc-text">3: Native和web本地缓存数据区别</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#web本地数据缓存方式"><span class="toc-text">web本地数据缓存方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Native本地数据缓存"><span class="toc-text">Native本地数据缓存</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Native和web多页面之间通信区别"><span class="toc-text">4: Native和web多页面之间通信区别</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#web多页面通信-同源多tab，不同源父子页面"><span class="toc-text">web多页面通信(同源多tab，不同源父子页面)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#原理-1"><span class="toc-text">原理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#方法"><span class="toc-text">方法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Native多页面通信"><span class="toc-text">Native多页面通信</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-Native和web多线程和异步流程控制"><span class="toc-text">5: Native和web多线程和异步流程控制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#web多线程"><span class="toc-text">web多线程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web异步"><span class="toc-text">web异步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Native多线程和流程控制"><span class="toc-text">Native多线程和流程控制</span></a></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>
        <div class="index-about-mobile">
            <i>  </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        从web前端看macOs开发
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2019-07-10 20:00:05</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#macOs开发" title="macOs开发">macOs开发</a>
        <span>/</span>
        
        <a class="tag" href="/tags/#web和mac对比" title="web和mac对比">web和mac对比</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <h3 id="1-Native与webview交互"><a href="#1-Native与webview交互" class="headerlink" title="1: Native与webview交互"></a>1: Native与webview交互</h3><h4 id="A-Native取得window对象"><a href="#A-Native取得window对象" class="headerlink" title="A:Native取得window对象"></a>A:Native取得window对象</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">js:</span><br><span class="line">window.location.href = &apos;http://spring-studio.net&apos;;</span><br><span class="line"></span><br><span class="line">oc:</span><br><span class="line">[[webView windowScriptObject] setValue:@&quot;http://spring-studio.net&quot;forKeyPath:@&quot;location.href&quot;];</span><br></pre></td></tr></table></figure>
<h4 id="B-Native调用JavaScript-Function"><a href="#B-Native调用JavaScript-Function" class="headerlink" title="B:Native调用JavaScript Function"></a>B:Native调用JavaScript Function</h4><h5 id="js调用Native"><a href="#js调用Native" class="headerlink" title="js调用Native"></a>js调用Native</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">oc:</span><br><span class="line">[[webView windowScriptObject] evaluateWebScript:@&quot;function x(x) &#123; return x + 1;&#125;&quot;];</span><br><span class="line"></span><br><span class="line">js:</span><br><span class="line">window.x(1);</span><br></pre></td></tr></table></figure>
<h5 id="Native调用js"><a href="#Native调用js" class="headerlink" title="Native调用js"></a>Native调用js</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">oc:</span><br><span class="line">[[webView windowScriptObject] evaluateWebScript:[NSString stringWithFormat:@&quot;showPromoAd(&apos;%@&apos;,&apos;%@&apos;);&quot;,self.word, computerSerialNumber()]];</span><br><span class="line"></span><br><span class="line">js:</span><br><span class="line">function showPromoAd(word, id)&#123;</span><br><span class="line">    console.log(word, id);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="C-Native操作DOM"><a href="#C-Native操作DOM" class="headerlink" title="C:Native操作DOM"></a>C:Native操作DOM</h4><ul>
<li>WebKit 里头，所有的 DOM 对象都继承自 DOMObject，DOMObject 又继承自 WebScriptObject，所以我们在取得了某个 DOM 对象之后，也可以从 Objective-C 程序中，要求这个 DOM 对象执行 JS 程序<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">js:</span><br><span class="line">document.querySelector(&apos;#s&apos;).focus();</span><br><span class="line"></span><br><span class="line">oc:</span><br><span class="line">DOMDocument *document = [[webView mainFrame] DOMDocument];</span><br><span class="line">[[document querySelector:@&quot;#s&quot;] callWebScriptMethod:@&quot;focus&quot;withArguments:nil];</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-Native和web页面jsbridge通信"><a href="#2-Native和web页面jsbridge通信" class="headerlink" title="2:Native和web页面jsbridge通信"></a>2:Native和web页面jsbridge通信</h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><ul>
<li>在windows下面添加webviewJsbridge对象</li>
<li>然后在webview中动态的创建一个Iframe</li>
<li>Native内部通过iframe的src进行通信，每次注册方法和调用方法动态的改变src</li>
<li>调用 js 中的方法_handleMessageFromObjC 进行数据交互</li>
</ul>
<h4 id="工作流"><a href="#工作流" class="headerlink" title="工作流"></a>工作流</h4><ul>
<li>JS 端加入 src 为 <a href="https://bridge_loaded" target="_blank" rel="noopener">https://bridge_loaded</a> 的 iframe</li>
<li>Native 端检测到 Request，检测如果是 bridge_loaded 则通过当前的 WebView 组件注入 WebViewJavascriptBridge_JS 代码</li>
<li>注入代码成功之后会加入一个 messagingIframe，其 src 为 <a href="https://wvjb_queue_message" target="_blank" rel="noopener">https://wvjb_queue_message</a></li>
<li>之后不论是 Native 端还是 JS 端都可以通过 registerHandler 方法注册一个两端约定好的 HandlerName 的处理，也都可以通过 callHandler 方法通过约定好的 HandlerName 调用另一端的处理（两端处理消息的实现逻辑对称）</li>
</ul>
<h4 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h4><p>//Native端</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1. 引入依赖库文件</span><br><span class="line">#import &quot;WebViewJavascriptBridge.h&quot;</span><br><span class="line"></span><br><span class="line">2. 实例化一个对象</span><br><span class="line">self.bridge = [WebViewJavascriptBridge bridgeForWebView:webView];</span><br><span class="line"></span><br><span class="line">3. 注册前端方法+主动推送给前端</span><br><span class="line">//供前端调用</span><br><span class="line">[self.bridge registerHandler:@&quot;OCTest&quot; handler:^(id data, WVJBResponseCallback responseCallback) &#123;</span><br><span class="line">    NSLog(@&quot;ObjC Echo called with: %@&quot;, data);</span><br><span class="line">    responseCallback(data);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">//主动推送给前端</span><br><span class="line">[self.bridge callHandler:@&quot;JsTest&quot; data:nil responseCallback:^(id responseData) &#123;</span><br><span class="line">    NSLog(@&quot;ObjC received response: %@&quot;, responseData);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>//web端<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function setupWebViewJavascriptBridge(callback) &#123;</span><br><span class="line">    if (window.WebViewJavascriptBridge) &#123; return callback(WebViewJavascriptBridge); &#125;</span><br><span class="line">    if (window.WVJBCallbacks) &#123; return window.WVJBCallbacks.push(callback); &#125;</span><br><span class="line">    window.WVJBCallbacks = [callback];</span><br><span class="line">    var WVJBIframe = document.createElement(&apos;iframe&apos;);</span><br><span class="line">    WVJBIframe.style.display = &apos;none&apos;;</span><br><span class="line">    WVJBIframe.src = &apos;https://__bridge_loaded__&apos;;</span><br><span class="line">    document.documentElement.appendChild(WVJBIframe);</span><br><span class="line">    setTimeout(function() &#123; document.documentElement.removeChild(WVJBIframe) &#125;, 0)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setupWebViewJavascriptBridge(function(bridge) &#123;</span><br><span class="line">	 //主动调用</span><br><span class="line">    bridge.registerHandler(&apos;JsTest&apos;, function(data, responseCallback) &#123;</span><br><span class="line">        console.log(&quot;JS Echo called with:&quot;, data)</span><br><span class="line">        responseCallback(data)</span><br><span class="line">    &#125;)</span><br><span class="line">	//接受oc端主动推送的消息</span><br><span class="line">    bridge.callHandler(&apos;OCTest&apos;, &#123;&apos;key&apos;:&apos;value&apos;&#125;, function responseCallback(responseData) &#123;</span><br><span class="line">        console.log(&quot;JS received response:&quot;, responseData)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h3 id="3-Native和web本地缓存数据区别"><a href="#3-Native和web本地缓存数据区别" class="headerlink" title="3: Native和web本地缓存数据区别"></a>3: Native和web本地缓存数据区别</h3><h4 id="web本地数据缓存方式"><a href="#web本地数据缓存方式" class="headerlink" title="web本地数据缓存方式"></a>web本地数据缓存方式</h4><ul>
<li>cookie</li>
<li>sessionStorage</li>
<li>localStorage</li>
<li>indexedDB</li>
<li>pwa离线解决方案(serviceWorker子线程、无法操作DOM)</li>
</ul>
<h4 id="Native本地数据缓存"><a href="#Native本地数据缓存" class="headerlink" title="Native本地数据缓存"></a>Native本地数据缓存</h4><ul>
<li>NSUserDefaults<ul>
<li>一般应用来存储应用设置信息，文件放在perference目录下。</li>
</ul>
</li>
<li>FMDB<ul>
<li>FMDB是iOS平台的SQLite数据库框架，FMDB以OC的方式封装了SQLite的C语言API，使用起来更加面向对象</li>
</ul>
</li>
<li>直接写文件<ul>
<li>Documents:(iTunes同步设备时会备份该目录)</li>
<li>tmp</li>
<li>Library<br><em>Caches (不会被同步)
</em>Preference(应用设置，iTunes同步设备时会备份该目录) </li>
</ul>
</li>
</ul>
<h3 id="4-Native和web多页面之间通信区别"><a href="#4-Native和web多页面之间通信区别" class="headerlink" title="4: Native和web多页面之间通信区别"></a>4: Native和web多页面之间通信区别</h3><h4 id="web多页面通信-同源多tab，不同源父子页面"><a href="#web多页面通信-同源多tab，不同源父子页面" class="headerlink" title="web多页面通信(同源多tab，不同源父子页面)"></a>web多页面通信(同源多tab，不同源父子页面)</h4><h5 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h5><ul>
<li>获取页面句柄，定向通信。</li>
<li>共享内存，完成相应的业务。</li>
</ul>
<h5 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h5><ul>
<li>window.open()、postMessage</li>
<li>BroadcastChannel</li>
<li>SharedWorker</li>
<li>cookie、localStorage。(sessionStorage不支持多页面通信)</li>
</ul>
<h4 id="Native多页面通信"><a href="#Native多页面通信" class="headerlink" title="Native多页面通信"></a>Native多页面通信</h4><ul>
<li>属性传值</li>
<li>单例传值</li>
<li>NSUserDefaults(本地设置)</li>
<li>代理传值</li>
<li>block传值</li>
<li>NSNotificationCenter(通知中心)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//先监听</span><br><span class="line">[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(updateValue:) name:@&quot;postValue&quot; object:nil];</span><br><span class="line"></span><br><span class="line">-(void)updateValue:(NSNotification*)not&#123;</span><br><span class="line">    self.lable.text = not.userInfo[@&quot;val&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//发送广播</span><br><span class="line"> [[NSNotificationCenter defaultCenter] postNotificationName:@&quot;postValue&quot; object:nil userInfo:@&#123;@&quot;val&quot;:self.inputText&#125;];</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="5-Native和web多线程和异步流程控制"><a href="#5-Native和web多线程和异步流程控制" class="headerlink" title="5: Native和web多线程和异步流程控制"></a>5: Native和web多线程和异步流程控制</h3><h4 id="web多线程"><a href="#web多线程" class="headerlink" title="web多线程"></a>web多线程</h4><ul>
<li>new worker(work.js)，把耗时较长的任务交给子线程处理，主线程处理ui操作，任务完成worker.postMessage()告诉给主线程。</li>
<li>worker和主线程不在同一上下文，使用限制：不能访问DOM、BOM、同源策略</li>
<li><a href="https://github.com/mdn/simple-web-worker" target="_blank" rel="noopener">demo</a></li>
</ul>
<h4 id="web异步"><a href="#web异步" class="headerlink" title="web异步"></a>web异步</h4><ul>
<li>ajax</li>
<li>setTimeout</li>
<li>Promise</li>
</ul>
<h4 id="Native多线程和流程控制"><a href="#Native多线程和流程控制" class="headerlink" title="Native多线程和流程控制"></a>Native多线程和流程控制</h4><ul>
<li><p>GCD</p>
<ul>
<li>同步/异步、串行/并行</li>
<li>dispath_get_global_queue &amp; dispatch_get_main_queue</li>
<li>dispatch_group_async</li>
<li>dispatch_once</li>
<li>dispatch_afte，将任务添加到队列延迟执行，类似setTimeout。</li>
</ul>
</li>
<li><p>NSOperation</p>
<ul>
<li>实现方式:<ul>
<li>NSInvocationOperation &amp; NSBlockOperation（同步阻塞）</li>
<li>自定义类继承NSOperation</li>
</ul>
</li>
</ul>
</li>
<li><p>NSThread</p>
</li>
</ul>

        
        <div id="comment-container">
        </div>
    </div>

    <div style="position:fixed;right:10px;bottom:15px;color: #999;cursor: pointer;" onclick="window.scrollTo(0,0)">回到顶部</div>
</div>
    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        
        <li>
            <a target="_blank"  href="https://github.com/fanky-c">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        

    </ul>
    
    <p style="padding-top:10px;">
        <span>/</span>
        
            
               <span><a href="http://www.fankyc.cn">fanky_c</a></span>
            
        <span>/</span>
        
            
               <span><a href="https://beian.miit.gov.cn" target="_blank">粤ICP备19149804号</a></span>
            
        <span>/</span>
        
            
               <span><a href="#">It helps SEO</a></span>
            
        <span>/</span>
        
    </p>
    
    <p style="padding-top:5px;">
        <!--<span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>-->
        Created By <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a>
    </p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<!-- <script async src="//cdn.jsdelivr.net/gh/sukkaw/busuanzi@2.3/bsz.pure.mini.js"></script> -->

</html>
