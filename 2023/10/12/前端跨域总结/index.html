<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <!--  禁止百度引擎抓取 -->
    <meta name="Baiduspider" content="noarchive">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="js、nodejs、css、nginx、vue、react">
    <meta name="keyword" content="网易">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        前端跨域总结 - fanky_c的博客 | fanky_c&#39;s Blog
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i>  </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar">
            <img src="/img/avatar.jpg" />
        </div>
        <div class="name">
            <i>fanky_c</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1、什么是跨域"><span class="toc-text">1、什么是跨域</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-什么是同源策略？"><span class="toc-text">1.1 什么是同源策略？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、常见的跨域场景"><span class="toc-text">2、常见的跨域场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3、跨域的解决方案"><span class="toc-text">3、跨域的解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-JSONP跨域"><span class="toc-text">3.1 JSONP跨域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-跨域资源共享（CORS）"><span class="toc-text">3.2 跨域资源共享（CORS）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-nginx代理跨域"><span class="toc-text">3.3 nginx代理跨域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-nodejs中间件代理跨域"><span class="toc-text">3.4 nodejs中间件代理跨域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-document-domain-iframe跨域"><span class="toc-text">3.5 document.domain + iframe跨域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-postMessage跨域"><span class="toc-text">3.6 postMessage跨域</span></a></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>
        <div class="index-about-mobile">
            <i>  </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        前端跨域总结
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2023-10-12 19:11:29</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#cors" title="cors">cors</a>
        <span>/</span>
        
        <a class="tag" href="/tags/#跨站资源共享" title="跨站资源共享">跨站资源共享</a>
        <span>/</span>
        
        <a class="tag" href="/tags/#前端跨域" title="前端跨域">前端跨域</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <h2 id="1、什么是跨域"><a href="#1、什么是跨域" class="headerlink" title="1、什么是跨域"></a>1、什么是跨域</h2><p>在前端领域中，跨域是指浏览器允许向服务器发送跨域请求，从而克服浏览器同源限制</p>
<h3 id="1-1-什么是同源策略？"><a href="#1-1-什么是同源策略？" class="headerlink" title="1.1 什么是同源策略？"></a>1.1 什么是同源策略？</h3><p>同源策略是一种约定，由Netscape公司1995年引入浏览器，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，浏览器很容易受到XSS、CSFR等攻击。<strong>所谓同源是指”协议+域名+端口”三者相同，即便两个不同的域名指向同一个ip地址，也非同源。</strong></p>
<p>同源策略限制以下几种行为：</p>
<ul>
<li>Cookie、LocalStorage 和 IndexDB 无法读取</li>
<li>DOM和JS对象无法获得</li>
<li>xhr请求不能发送</li>
</ul>
<h2 id="2、常见的跨域场景"><a href="#2、常见的跨域场景" class="headerlink" title="2、常见的跨域场景"></a>2、常见的跨域场景</h2><table border="1"><br>  <thead><br>    <tr><br>      <th>URL</th><br>      <th>说明</th><br>      <th>是否允许通信</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <td><br>      1. <a href="http://www.domain.com/a.js" target="_blank" rel="noopener">www.domain.com/a.js</a><br>      2. <a href="http://www.domain.com/b.js" target="_blank" rel="noopener">www.domain.com/b.js</a><br>      3. <a href="http://www.domain.com/lab/c.js" target="_blank" rel="noopener">www.domain.com/lab/c.js</a><br>      </td><br>      <td>同一域名，不同文件或路径</td><br>      <td>允许</td><br>    </tr><br>    <tr><br>      <td><br>      1. <a href="http://www.domain.com:8000/a.js" target="_blank" rel="noopener">www.domain.com:8000/a.js</a><br>      2. <a href="http://www.domain.com/b.js" target="_blank" rel="noopener">www.domain.com/b.js</a><br>      </td><br>      <td>同一域名，不同端口</td><br>      <td>不允许</td><br>    </tr><br>    <tr><br>      <td><br>        1. <a href="http://www.domain.com/a.js" target="_blank" rel="noopener">http://www.domain.com/a.js</a><br>        2. <a href="http://192.168.4.12/b.js" target="_blank" rel="noopener">http://192.168.4.12/b.js</a><br>      </td><br>      <td>域名和域名对应相同ip</td><br>      <td>不允许</td><br>    </tr><br>    <tr><br>      <td><br>          1. <a href="http://www.domain.com/a.js" target="_blank" rel="noopener">http://www.domain.com/a.js</a><br>          2. <a href="http://x.domain.com/b.js" target="_blank" rel="noopener">http://x.domain.com/b.js</a><br>          3. <a href="http://domain.com/c.js" target="_blank" rel="noopener">http://domain.com/c.js</a><br>      </td><br>      <td>主域相同，子域不同</td><br>      <td>不允许</td><br>    </tr><br>  </tbody><br></table>


<h2 id="3、跨域的解决方案"><a href="#3、跨域的解决方案" class="headerlink" title="3、跨域的解决方案"></a>3、跨域的解决方案</h2><h3 id="3-1-JSONP跨域"><a href="#3-1-JSONP跨域" class="headerlink" title="3.1 JSONP跨域"></a>3.1 JSONP跨域</h3><p>jsonp的原理就是利用&lt;script>标签没有跨域限制，通过&lt;script>标签src属性，发送带有callback参数的GET请求，服务端将接口返回数据拼凑到callback函数中，返回给浏览器，浏览器解析执行，从而前端拿到callback函数返回的数据。</p>
<p><strong>缺点：jsonp的缺点：只能发送get一种请求。</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 前端</span></span><br><span class="line"> &lt;script&gt;</span><br><span class="line">    <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    script.type = <span class="string">'text/javascript'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 传参一个回调函数名给后端，方便后端返回时执行这个在前端定义的回调函数</span></span><br><span class="line">    script.src = <span class="string">'http://www.domain2.com:8080/login?user=admin&amp;callback=handleCallback'</span>;</span><br><span class="line">    <span class="built_in">document</span>.head.appendChild(script);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 回调执行函数</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">handleCallback</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">        alert(<span class="built_in">JSON</span>.stringify(res));</span><br><span class="line">    &#125;</span><br><span class="line"> &lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ nodejs 服务端</span></span><br><span class="line"><span class="regexp">var querystring = require('querystring');</span></span><br><span class="line"><span class="regexp">var http = require('http');</span></span><br><span class="line"><span class="regexp">var server = http.createServer();</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">server.on('request', function(req, res) &#123;</span></span><br><span class="line"><span class="regexp">    var params = querystring.parse(req.url.split('?')[1]);</span></span><br><span class="line"><span class="regexp">    var fn = params.callback;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ jsonp返回设置</span></span><br><span class="line"><span class="regexp">    res.writeHead(200, &#123; 'Content-Type': 'text/</span>javascript<span class="string">' &#125;);</span></span><br><span class="line"><span class="string">    res.write(fn + '</span>(<span class="string">' + JSON.stringify(params) + '</span>)<span class="string">');</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    res.end();</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.listen('</span><span class="number">8080</span><span class="string">');</span></span><br><span class="line"><span class="string">console.log('</span>Server is running at port <span class="number">8080.</span>..<span class="string">');</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-跨域资源共享（CORS）"><a href="#3-2-跨域资源共享（CORS）" class="headerlink" title="3.2 跨域资源共享（CORS）"></a>3.2 跨域资源共享（CORS）</h3><p> CORS是一个W3C标准，全称是”跨域资源共享”（Cross-origin resource sharing）。<br>它允许浏览器向跨源服务器，发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。<br>CORS需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE浏览器不能低于IE10。</p>
<p>浏览器将CORS跨域请求分为简单请求和非简单请求。</p>
<p><strong>A、只要同时满足一下两个条件，就属于简单请求：</strong></p>
<ol>
<li>使用下列方法之一：head、get、post</li>
<li>请求的Heder是: <ol>
<li>Accept</li>
<li>Accept-Language</li>
<li>Content-Language</li>
<li>Content-Type: 只限于三个值：application/x-www-form-urlencoded、multipart/form-data、text/plain</li>
</ol>
</li>
</ol>
<p>对于简单请求，浏览器直接发出CORS请求。具体来说，就是在头信息之中，增加一个Origin字段。</p>
<p><strong>B、复杂请求：</strong><br>非简单请求是那种对服务器有特殊要求的请求，比如请求方法是PUT或DELETE，或者Content-Type字段的类型是application/json。非简单请求的CORS请求，会在正式通信之前，增加一次HTTP查询请求，称为”预检”请求（preflight）。</p>
<p><strong>预检请求</strong></p>
<p> 预检”请求用的请求方法是OPTIONS，表示这个请求是用来询问的。请求头信息里面，关键字段是Origin，表示请求来自哪个源。除了Origin字段，”预检”请求的头信息包括两个特殊字段。</p>
<p>  1）Access-Control-Request-Method：必选</p>
<p>  2）Access-Control-Request-Headers：可选</p>
<h3 id="3-3-nginx代理跨域"><a href="#3-3-nginx代理跨域" class="headerlink" title="3.3 nginx代理跨域"></a>3.3 nginx代理跨域</h3><p>nginx代理跨域，实质和CORS跨域原理一样，通过配置文件设置请求响应头Access-Control-Allow-Origin等字段。</p>
<p>1）nginx配置解决iconfont跨域</p>
<p>  浏览器跨域访问js、css、img等常规静态资源被同源策略许可，但iconfont字体文件(eot|otf|ttf|woff|svg)例外，此时可在nginx的静态资源服务器中加入以下配置。</p>
<p>2）nginx反向代理接口跨域</p>
<h3 id="3-4-nodejs中间件代理跨域"><a href="#3-4-nodejs中间件代理跨域" class="headerlink" title="3.4 nodejs中间件代理跨域"></a>3.4 nodejs中间件代理跨域</h3><h3 id="3-5-document-domain-iframe跨域"><a href="#3-5-document-domain-iframe跨域" class="headerlink" title="3.5 document.domain + iframe跨域"></a>3.5 document.domain + iframe跨域</h3><p><strong>此方案仅限主域相同，子域不同的跨域应用场景。实现原理：两个页面都通过js强制设置document.domain为基础主域，就实现了同域。</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父窗口</span></span><br><span class="line">&lt;iframe id=<span class="string">"iframe"</span> src=<span class="string">"http://child.domain.com/b.html"</span>&gt;&lt;<span class="regexp">/iframe&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">    document.domain = 'domain.com';</span></span><br><span class="line"><span class="regexp">    var user = 'admin';</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 子窗口</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="built_in">document</span>.domain = <span class="string">'domain.com'</span>;</span><br><span class="line">    <span class="comment">// 获取父窗口中变量</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'get js data from parent ---&gt; '</span> + <span class="built_in">window</span>.parent.user);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-6-postMessage跨域"><a href="#3-6-postMessage跨域" class="headerlink" title="3.6 postMessage跨域"></a>3.6 postMessage跨域</h3><p> postMessage是HTML5 XMLHttpRequest Level 2中的API，且是为数不多可以跨域操作的window属性之一，它可用于解决以下方面的问题：</p>
<ol>
<li>页面和其打开的新窗口的数据传递</li>
<li>多窗口之间消息传递</li>
<li>页面与嵌套的iframe消息传递</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.html (www.domain1.com/a.html)</span></span><br><span class="line">&lt;iframe id=<span class="string">"iframe"</span> src=<span class="string">"http://www.domain2.com/b.html"</span> style=<span class="string">"display:none;"</span>&gt;&lt;<span class="regexp">/iframe&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;       </span></span><br><span class="line"><span class="regexp">    var iframe = document.getElementById('iframe');</span></span><br><span class="line"><span class="regexp">    iframe.onload = function() &#123;</span></span><br><span class="line"><span class="regexp">        var data = &#123;</span></span><br><span class="line"><span class="regexp">            name: 'aym'</span></span><br><span class="line"><span class="regexp">        &#125;;</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/ 向domain2传送跨域数据</span></span><br><span class="line"><span class="regexp">        iframe.contentWindow.postMessage(JSON.stringify(data), 'http:/</span><span class="regexp">/www.domain2.com');</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ 接受domain2返回数据</span></span><br><span class="line"><span class="regexp">    window.addEventListener('message', function(e) &#123;</span></span><br><span class="line"><span class="regexp">        alert('data from domain2 ---&gt; ' + e.data);</span></span><br><span class="line"><span class="regexp">    &#125;, false);</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// b.html (www.domain2.com/b.html)</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">// 接收domain1的数据</span></span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">        alert(<span class="string">'data from domain1 ---&gt; '</span> + e.data);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> data = <span class="built_in">JSON</span>.parse(e.data);</span><br><span class="line">        <span class="keyword">if</span> (data) &#123;</span><br><span class="line">            data.number = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 处理后再发回domain1</span></span><br><span class="line">            <span class="built_in">window</span>.parent.postMessage(<span class="built_in">JSON</span>.stringify(data), <span class="string">'http://www.domain1.com'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="literal">false</span>);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p><br><br><a href="https://juejin.cn/post/6844903882083024910" target="_blank" rel="noopener">参考文档</a></p>

        
        <div id="comment-container">
        </div>
    </div>

    <div style="position:fixed;right:10px;bottom:15px;color: #999;cursor: pointer;" onclick="window.scrollTo(0,0)">回到顶部</div>
</div>
    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        
        <li>
            <a target="_blank"  href="https://github.com/fanky-c">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        

    </ul>
    
    <p style="padding-top:10px;">
        <span>/</span>
        
            
               <span><a href="http://www.fankyc.cn">fanky_c</a></span>
            
        <span>/</span>
        
            
               <span><a href="https://beian.miit.gov.cn" target="_blank">粤ICP备19149804号</a></span>
            
        <span>/</span>
        
            
               <span><a href="#">It helps SEO</a></span>
            
        <span>/</span>
        
    </p>
    
    <p style="padding-top:5px;">
        <!--<span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>-->
        Created By <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a>
    </p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<!-- <script async src="//cdn.jsdelivr.net/gh/sukkaw/busuanzi@2.3/bsz.pure.mini.js"></script> -->

</html>
