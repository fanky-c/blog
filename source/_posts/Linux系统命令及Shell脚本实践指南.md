---
title: Linux系统命令及Shell脚本实践指南
date: 2022-04-25 14:28:05
tags:
  - linux系统
  - shell脚本
  - 读书笔记
---

## linux简介
### linux的特点
1. **免费开源。**Linux是一款完全免费的操作系统，任何人都可以从网络上下载到它的源代码，并可以根据自己的需求进行定制化的开发，而且没有版权限制。
2. **模块化程度高。**Linux的内核设计分成进程管理、内存管理、进程间通信、虚拟文件系统、网络5部分，其采用的模块机制使得用户可以根据实际需要，在内核中插入或移走模块，这使得内核可以被高度的剪裁定制，以方便在不同的场景下使用。
3. **广泛的硬件支持。**得益于其免费开源的特点，有大批程序员不断地向Linux社区提供代码，使得Linux有着异常丰富的设备驱动资源，对主流硬件的支持极好，而且几乎能运行在所有流行的处理器上。
4. **安全稳定。**Linux采取了很多安全技术措施，包括读写权限控制、带保护的子系统、审计跟踪、核心授权等，这为网络环境中的用户提供了安全保障。实际上有很多运行Linux的服务器可以持续运行长达数年而无须重启，依然可以性能良好地提供服务，其安全稳定性已经在各个领域得到了广泛的证实。
5. **多用户，多任务。**多用户是指系统资源可以同时被不同的用户使用，每个用户对自己的资源有特定的权限，互不影响。多任务是现代化计算机的主要特点，指的是计算机能同时运行多个程序，且程序之间彼此独立，Linux内核负责调度每个进程，使之平等地访问处理器。由于CPU处理速度极快，从用户的角度来看所有的进程好像在并行运行。
6. **良好的可移植性。**Linux中95%以上的代码都是用C语言编写的，由于C语言是一种机器无关的高级语言，是可移植的，因此Linux系统也是可移植的。


### linux启动流程
1. 首先，计算机会加载BIOS，这是计算机上最接近硬件的软件，各家主板制造商都会开发适合自己主板的BIOS，而BIOS中一项很重要的功能就是对自身的硬件做一次健康检查，只有硬件没有问题，才能运行软件，记住，操作系统也是一种软件
2. 机器自检通过后，下面就要引导系统了。这个动作是BIOS设定的，BIOS默认会从硬盘上的第0柱面、第0磁道、第一个扇区中读取被称为MBR的东西，即主引导记录
3. 第三步就是顺理成章地运行Grub了。Grub最重要的功能就是根据其配置文件加载kernel镜像，并运行内核加载后的第一个程序/sbin/init，这个程序会根据/etc/inittab来进行初始化的工作
4. Linux将根据/etc/inittab中定义的系统初始化配置si::sysinit:/etc/rc.d/rc.sysinit执行/etc/rc.sysinit脚本，该脚本将会设置系统变量、网络配置，并启动swap、设定/proc、加载用户自定义模块、加载内核设置等。
5. 根据第三步读到的runlevel值来启动对应的服务，如果值为3，就会运行/etc/rc3.d/下的所有脚本，如果值为5，就会运行/etc/rc5.d/下的所有脚本。
6. 将运行/etc/rc.local
7. 会生成终端或X Window来等待用户登录


### linux帮助命令
#### 使用man page
```sh
man ls
```

#### 使用info page
可以在命令行中输入info ls来显示ls命令的说明文
```sh
info ls
```

## linux用户管理
### linux用户和用户组
#### uid和gid
Linux系统中的用户分为3类，**即普通用户、根用户、系统用户。**
1. 普通用户: 通常普通用户的UID大于500，因为在添加普通用户时，系统默认用户ID从500开始编号。
2. 根用户: 根用户也就是root用户，它的ID是0，也被称为超级用户，root账户拥有对系统的完全控制权：可以修改、删除任何文件，运行任何命令。所以root用户也是系统里面最具危险性的用户，root用户甚至可以在系统正常运行时删除所有文件系统，造成无法挽回的灾难。
3. 系统用户：系统用户是指系统运行时必须有的用户，但并不是指真实的使用者。系统用户的ID范围是1~499 

```sh
#要确认自己的UID，可以使用以下id命令来获得：
id

#要确认自己所属的用户组，可以使用以下groups命令来获得
groups

#如果要查询当前在线用户，可在用户登录以后，使用命令who看到目前登录在系统中的所有用户
who
```

#### /etc/passwd 和 /etc/shadow
在登录Linux时必须要输入用户名和密码。而系统用来记录用户名、密码最重要的两个文件就是/etc/passwd 和 /etc/shadow(而且默认只有root用户才有读的权限，其他人完全没有读取这个文件的可能)
### linux账号管理
#### 新增和删除用户
1. 新增用户： useradd
2. 修改密码： passwd
3. 修改用户： usermod
4. 删除用户： userdel

#### 新增和删除用户组
1. 新增用户组： groupadd
2. 删除用户组： groupdel

#### 检查用户信息
1. 查看用户： users、who、w
```sh
#使用命令users可以查看当前系统有哪些用户。比如，在当前的系统中运行users命令，就会发现有两个root在当前机器上登录。
users

#第一列是登录用户的用户名，第二列是用户登录的终端，第三列是用户登录的时间。
who

#w命令的第一行会显示当前时间、系统运行时间、已登录的用户数量和系统负载。下面显示的信息分为8列
w
```

2. 调查用户：finger
```sh
#如果在finger后跟上某个用户名，则显示该用户更详细的信息，
finger user1
```

### linux切换用户
#### 切换其他用户
假如说我以普通用户john登录到系统中，这时候想使用useradd添加一个用户，怎么办？普通用户是没有添加用户的权限的，只有root用户才能创建用户。当然我们可以使用exit命令退出当前用户，然后使用root用户登录，再使用useradd添加用户。但是也有一种更方便的方式，那就是使用su命令，su是切换用户的意思。在不加参数的情况下，su命令默认表示切换到root用户，之后只要输入root密码就可以切换身份为root了，完成操作后，使用exit命令可以退出root切换到原先的用户。如下所示：
```sh
#su命令默认表示切换到root用户，之后只要输入root密码就可以切换身份为root了，
#完成操作后，使用exit命令可以退出root切换到原先的用户
su

#加上-这个参数后，切换成root用户时，不但身份变成了root，而且还能应用root的用户环境
su -
```
**使用su命令切换用户之后，当前的用户环境并没有发生变化，而使用su-命令切换用户后，用户环境变成root的了**
#### 用其他用户的身份执行命令：sudo
sudo并不是真的切换了用户，而是使用其他用户的身份和权限执行了命令。



### linux例行任务管理
>在Linux中也有处理这两种任务的方法。如果任务是周期性执行的，其命令为cron；如果只是在某一个特定的时间执行一次，其命令为at。
#### 单一时刻执行一次任务：at
*默认情况下，所有用户都可以使用at命令来调度自己的任务，如果由于特殊的原因需要禁止某些用户使用这个功能，可以将该用户的用户名添加至/etc/at.deny*

#### 周期性执行任务：cron
*有一些任务是需要周期性执行的，比如说每天早晨的闹钟会在设定的时间准时响起*
1. 启动crond进程
```sh
service crond start

service crond status
```
2. 编辑任务crontab -e
```sh
* * * * * command

#前面5个*可以用来定义时间，
#第一个*表示分钟，可以使用的值是1~59，每分钟可以使用*和*/1表示；
#第二个*表示小时，可以使用的值是0~23；
#第三个*表示日期，可以使用的值是1~31；
#第四个*表示月份，可以使用的值是1~12；
#第五个*表示星期几，可以使用的值是0~6，0代表星期日；
#最后是执行的命令
```

3. 示例
```sh
*  *  *  *  * service httpd restart
*/1  *  *  *  * service httpd restart
#这两种写法其实是一致的，都是每分钟重启httpd进程。请注意，这只是一个例子，除非你有确定的目的，否则不要在实际生产环境中这么设置

*  */1  *  *  * service httpd restart
#每小时重启httpd 进程


*  23-3/1  *  *  * service httpd restart
#从23点开始到3点，每小时重启httpd 进程


30 23 *  *  * service httpd restart
#每天晚上23点30分重启httpd进程


30 23 1  *  * service httpd restart
#每月的第一天晚上23点30分重启httpd进程


30 23 1  1  * service httpd restart
#每年1月1日的晚上23点30分重启httpd进程


30 23 *  *  0 service httpd restart
#每周日晚上23点30分重启httpd进程
```

4. 查看定时任务 crontab -l
   
*如果由于特殊的原因需要禁止某些用户使用这个功能，可以将该用户的用户名添加至/etc/cron.deny中*

#### /etc/crontab管理
我们知道用户可以通过crontab-e命令来编辑定义自己的任务，事实上，系统也有自己的例行任务，而其配置文件是/etc/crontab。
```sh
[root@localhost ~]# cat /etc/crontab
SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root
HOME=/

# run-parts
01 * * * * root run-parts /etc/cron.hourly
02 4 * * * root run-parts /etc/cron.daily
22 4 * * 0 root run-parts /etc/cron.weekly
42 4 1 * * root run-parts /etc/cron.monthly
```

## linux文件管理