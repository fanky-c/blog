---
title: Linux系统命令及Shell脚本实践指南
date: 2022-04-25 14:28:05
tags:
  - linux系统
  - shell脚本
  - 读书笔记
---

## linux简介
### linux的特点
1. **免费开源。**Linux是一款完全免费的操作系统，任何人都可以从网络上下载到它的源代码，并可以根据自己的需求进行定制化的开发，而且没有版权限制。
2. **模块化程度高。**Linux的内核设计分成进程管理、内存管理、进程间通信、虚拟文件系统、网络5部分，其采用的模块机制使得用户可以根据实际需要，在内核中插入或移走模块，这使得内核可以被高度的剪裁定制，以方便在不同的场景下使用。
3. **广泛的硬件支持。**得益于其免费开源的特点，有大批程序员不断地向Linux社区提供代码，使得Linux有着异常丰富的设备驱动资源，对主流硬件的支持极好，而且几乎能运行在所有流行的处理器上。
4. **安全稳定。**Linux采取了很多安全技术措施，包括读写权限控制、带保护的子系统、审计跟踪、核心授权等，这为网络环境中的用户提供了安全保障。实际上有很多运行Linux的服务器可以持续运行长达数年而无须重启，依然可以性能良好地提供服务，其安全稳定性已经在各个领域得到了广泛的证实。
5. **多用户，多任务。**多用户是指系统资源可以同时被不同的用户使用，每个用户对自己的资源有特定的权限，互不影响。多任务是现代化计算机的主要特点，指的是计算机能同时运行多个程序，且程序之间彼此独立，Linux内核负责调度每个进程，使之平等地访问处理器。由于CPU处理速度极快，从用户的角度来看所有的进程好像在并行运行。
6. **良好的可移植性。**Linux中95%以上的代码都是用C语言编写的，由于C语言是一种机器无关的高级语言，是可移植的，因此Linux系统也是可移植的。


### linux启动流程
1. 首先，计算机会加载BIOS，这是计算机上最接近硬件的软件，各家主板制造商都会开发适合自己主板的BIOS，而BIOS中一项很重要的功能就是对自身的硬件做一次健康检查，只有硬件没有问题，才能运行软件，记住，操作系统也是一种软件
2. 机器自检通过后，下面就要引导系统了。这个动作是BIOS设定的，BIOS默认会从硬盘上的第0柱面、第0磁道、第一个扇区中读取被称为MBR的东西，即主引导记录
3. 第三步就是顺理成章地运行Grub了。Grub最重要的功能就是根据其配置文件加载kernel镜像，并运行内核加载后的第一个程序/sbin/init，这个程序会根据/etc/inittab来进行初始化的工作
4. Linux将根据/etc/inittab中定义的系统初始化配置si::sysinit:/etc/rc.d/rc.sysinit执行/etc/rc.sysinit脚本，该脚本将会设置系统变量、网络配置，并启动swap、设定/proc、加载用户自定义模块、加载内核设置等。
5. 根据第三步读到的runlevel值来启动对应的服务，如果值为3，就会运行/etc/rc3.d/下的所有脚本，如果值为5，就会运行/etc/rc5.d/下的所有脚本。
6. 将运行/etc/rc.local
7. 会生成终端或X Window来等待用户登录


### linux帮助命令
#### 使用man page
```sh
man ls
```

#### 使用info page
可以在命令行中输入info ls来显示ls命令的说明文
```sh
info ls
```

## linux用户管理
### linux用户和用户组
#### uid和gid
Linux系统中的用户分为3类，**即普通用户、根用户、系统用户。**
1. 普通用户: 通常普通用户的UID大于500，因为在添加普通用户时，系统默认用户ID从500开始编号。
2. 根用户: 根用户也就是root用户，它的ID是0，也被称为超级用户，root账户拥有对系统的完全控制权：可以修改、删除任何文件，运行任何命令。所以root用户也是系统里面最具危险性的用户，root用户甚至可以在系统正常运行时删除所有文件系统，造成无法挽回的灾难。
3. 系统用户：系统用户是指系统运行时必须有的用户，但并不是指真实的使用者。系统用户的ID范围是1~499 

```sh
#要确认自己的UID，可以使用以下id命令来获得：
id

#要确认自己所属的用户组，可以使用以下groups命令来获得
groups

#如果要查询当前在线用户，可在用户登录以后，使用命令who看到目前登录在系统中的所有用户
who
```

#### /etc/passwd 和 /etc/shadow
在登录Linux时必须要输入用户名和密码。而系统用来记录用户名、密码最重要的两个文件就是/etc/passwd 和 /etc/shadow(而且默认只有root用户才有读的权限，其他人完全没有读取这个文件的可能)
### linux账号管理
#### 新增和删除用户
1. 新增用户： useradd
2. 修改密码： passwd
3. 修改用户： usermod
4. 删除用户： userdel

#### 新增和删除用户组
1. 新增用户组： groupadd
2. 删除用户组： groupdel

#### 检查用户信息
1. 查看用户： users、who、w
```sh
#使用命令users可以查看当前系统有哪些用户。比如，在当前的系统中运行users命令，就会发现有两个root在当前机器上登录。
users

#第一列是登录用户的用户名，第二列是用户登录的终端，第三列是用户登录的时间。
who

#w命令的第一行会显示当前时间、系统运行时间、已登录的用户数量和系统负载。下面显示的信息分为8列
w
```

2. 调查用户：finger
```sh
#如果在finger后跟上某个用户名，则显示该用户更详细的信息，
finger user1
```

### linux切换用户
#### 切换其他用户
假如说我以普通用户john登录到系统中，这时候想使用useradd添加一个用户，怎么办？普通用户是没有添加用户的权限的，只有root用户才能创建用户。当然我们可以使用exit命令退出当前用户，然后使用root用户登录，再使用useradd添加用户。但是也有一种更方便的方式，那就是使用su命令，su是切换用户的意思。在不加参数的情况下，su命令默认表示切换到root用户，之后只要输入root密码就可以切换身份为root了，完成操作后，使用exit命令可以退出root切换到原先的用户。如下所示：
```sh
#su命令默认表示切换到root用户，之后只要输入root密码就可以切换身份为root了，
#完成操作后，使用exit命令可以退出root切换到原先的用户
su

#加上-这个参数后，切换成root用户时，不但身份变成了root，而且还能应用root的用户环境
su -
```
**使用su命令切换用户之后，当前的用户环境并没有发生变化，而使用su-命令切换用户后，用户环境变成root的了**
#### 用其他用户的身份执行命令：sudo
sudo并不是真的切换了用户，而是使用其他用户的身份和权限执行了命令。



### linux例行任务管理
>在Linux中也有处理这两种任务的方法。如果任务是周期性执行的，其命令为cron；如果只是在某一个特定的时间执行一次，其命令为at。
#### 单一时刻执行一次任务：at
*默认情况下，所有用户都可以使用at命令来调度自己的任务，如果由于特殊的原因需要禁止某些用户使用这个功能，可以将该用户的用户名添加至/etc/at.deny*

#### 周期性执行任务：cron
*有一些任务是需要周期性执行的，比如说每天早晨的闹钟会在设定的时间准时响起*
1. 启动crond进程
```sh
service crond start

service crond status
```
2. 编辑任务crontab -e
```sh
* * * * * command

#前面5个*可以用来定义时间，
#第一个*表示分钟，可以使用的值是1~59，每分钟可以使用*和*/1表示；
#第二个*表示小时，可以使用的值是0~23；
#第三个*表示日期，可以使用的值是1~31；
#第四个*表示月份，可以使用的值是1~12；
#第五个*表示星期几，可以使用的值是0~6，0代表星期日；
#最后是执行的命令
```

3. 示例
```sh
*  *  *  *  * service httpd restart
*/1  *  *  *  * service httpd restart
#这两种写法其实是一致的，都是每分钟重启httpd进程。请注意，这只是一个例子，除非你有确定的目的，否则不要在实际生产环境中这么设置

*  */1  *  *  * service httpd restart
#每小时重启httpd 进程


*  23-3/1  *  *  * service httpd restart
#从23点开始到3点，每小时重启httpd 进程


30 23 *  *  * service httpd restart
#每天晚上23点30分重启httpd进程


30 23 1  *  * service httpd restart
#每月的第一天晚上23点30分重启httpd进程


30 23 1  1  * service httpd restart
#每年1月1日的晚上23点30分重启httpd进程


30 23 *  *  0 service httpd restart
#每周日晚上23点30分重启httpd进程
```

4. 查看定时任务 crontab -l
   
*如果由于特殊的原因需要禁止某些用户使用这个功能，可以将该用户的用户名添加至/etc/cron.deny中*

#### /etc/crontab管理
我们知道用户可以通过crontab-e命令来编辑定义自己的任务，事实上，系统也有自己的例行任务，而其配置文件是/etc/crontab。
```sh
[root@localhost ~]# cat /etc/crontab
SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root
HOME=/

# run-parts
01 * * * * root run-parts /etc/cron.hourly
02 4 * * * root run-parts /etc/cron.daily
22 4 * * 0 root run-parts /etc/cron.weekly
42 4 1 * * root run-parts /etc/cron.monthly
```

## linux文件管理
### 文件和目录管理
#### 文件的相关操作
Linux遵循一切皆文件的规则，对Linux进行配置时，在很大程度上就是处理文件的过程，所以掌握文件的相关操作是非常有必要的
1. 创建文件：touch
2. 删除文件：rm
3. 移动或重命名文件： mv，后面需要跟两个参数，**第一个参数是要被移动的文件，第二个参数是移动到的目录**
```sh
# 把test.log文件移动到/mnt中
mv test.log /mnt/ 
# 把test.log重命名为test1.log
mv test.log test1.log
# 移动文件的同时重命名文件
mv test.log /mnt/test2.log
```
4. 查看文件：cat
5. 查看文件头： head
```sh
# 默认情况下，head将显示该文件前10行的内容;也可以使用-n参数指定显示的行数
head -n 20 /text.log
```
6. 查看文件尾: tail
```sh
# 要动态地查看文件，使用-f参数就可以做到
tail -f /text.log
```
7. 文件格式转换：dos2unix, 当把Windows下的文本文件移动到Linux下时，会由于系统之间文本文件的换行符不同而造成文件在Linux下的读写操作有问题

#### 目录的相关操作
1. 创建目录：mkdir
```sh
# 可以使用-p参数一次性创建所有目录，这样就不用费力地一个个创建了，命令如下所示
mkdir -p dir2/dir3
```
2. 删除目录：rmdir和rm
```sh
# rmdir 用来删除目录。但是需要注意的是，它只能删除空目录，如果目录不为空（存在文件或者子目录），那么该命令将拒绝删除指定的目录
rmdir dir1 #提示dir1为非空目录

# rm
rm -rf dir1
```
3. 文件和目录复制：cp
```sh
# 复制文件且重命名
cp a.txt /tmp/b.txt

# 复制文件不重命名
cp a.txt /tmp/

# 复制目录所有文件
cp -rf /dir1/* /dir2/ 
```

#### 文件时间戳
通过touch可以创建新文件。如果文件已经存在，那么touch命令仅仅会更新文件的创建时间而不会修改文件内容。请记住，在Linux下目录也是一种文件，所以如果touch一个目录，这个目录的创建时间也会被更新

### 文件和目录权限
#### 查看文件或者目录权限: ls -al
```sh
# -l参数表示要求ls命令列出每个文件的详细信息，
# -a参数则要求ls命令还要同时列出隐藏文件
ls -al 
[root@localhost ~]# ls-al
total 112
drwxr-x---  3 root root  4096 Oct  1 10:43 .
drwxr-xr-x 24 root root  4096 Oct  1 07:42 ..
-rw-------  1 root root  5659 Sep 24 02:07 .bash_history
-rw-r--r--  1 root root    24 Jan  6  2007 .bash_logout
-rw-------  1 root root    72 Oct  1 08:45 .lesshst
drwx------  2 root root  4096 Oct  1 08:48 .ssh

#第一列：是文件类别和权限，这列由10个字符组成，第一个字符表明该文件的类型
#第二列：代表“连接数”，除了目录文件之外，其他所有文件的连接数都是1，目录文件的连接数是该目录中包含其他目录的总个数+2，也就是说，如果目录A中包含目录B和C，则目录A的连接数为4
#第三列：代表该文件的所有人
#第四列：代表该文件的所有组
#第五列：是该文件的大小
#第六列：是该文件的创建时间或最近的修改时间
#第七列：是文件名
```

第一列含义：
<img src="/img/linux1.jpeg" style="max-width:95%" />

#### 改变文件权限：chmod
Linux下的每个文件都定义了文件拥有者（user）、拥有组（group）、其他人（others）的权限，我们使用字母u、g、o来分别代表拥有者、拥有组、其他人，而对应的具体权限则使用rwx的组合来定义，增加权限使用+号，删除权限使用-号，详细权限使用=号。图中用一些例子说明了如何使用chmod来改变文件的权限。
<img src="/img/linux2.jpeg" style="max-width:95%" />
如果要给用户组或其他人添加或删除相关权限，只需要将上面的u相应地更换成g或o即可。但是正如大家看到的，这种方式同一时刻只能给文件拥有者、文件拥有组或是其他所有人设置权限，如果要想同时设置所有人的权限就需要使用数字表示法了，我们定义r=4，w=2，x=1，如果权限是rwx，则数字表示为7，如果权限是r-x，则数字表示为5。假设想设置一个文件的权限是：拥有者的权限是读、写、执行（rwx），拥有组的权限是读、执行（r-x），其他人的权限是只读（r--），那么可以使用命令chmod 754 somefile来设置

```sh
# 修改某个目录权限
chmod -R 754 somedir
```
#### 改变文件的拥有者：chown
```sh
# 修改文件拥有者
chown chao a.txt

# 修改文件拥有组
chown :chao a.txt

# 同时修改文件拥有者和拥有组
chown chao:chao a.txt

# 同时修改目录拥有者和拥有组
chown -R chao:chao somedir
```
#### 改变文件的拥有者：chown
```sh
chgrp -R chao somedir
```

#### 查看文件类型：file
使用ls-l令可以通过查看第一个字符判断文件类型。字母d代表目录、字母l代表连接文件，字母b代表块文件，字母c代表字符文件，字母s代表socket文件，字符-代表普通文件，字母p代表管道文件

### 查找文件
#### 一般查找 find
```sh
# 从根目录开始寻找名为httpd.conf的文件
find / -name httpd.conf

# 从etc目录开始寻找名为httpd.conf的文件
find /etc -name httpd.conf

# 查找系统所有以conf结尾的文件
find / -name *.conf

# 查找系统所有以http开头文件
find / -name httpd*
```
<img src="/img/linux3.jpeg" style="max-width:95%" />


#### 数据库查找 locate
与find不同，locate命令依赖于一个数据库文件，Linux系统默认每天会检索一下系统中的所有文件，然后将检索到的文件记录到数据库中，所以使用locate命令要比find命令反馈更为迅速。
```sh
# 更新数据库 --> 查找文件
updatedb
find /etc -name httpd.conf
```

#### 查找执行文件 which/whereis
which用于从系统的PATH变量所定义的目录中查找可执行文件的绝对路径。比如说想查找node这个命令在系统中的绝对路径
```sh
which node

# 使用whereis也能查到其路径，但是和which不同的是，
# 它不但能找出其二进制文件，还能找出相关的man文件：
whereis node
```

### 文件压缩和打包

## linux文件系统


## 字符处理

## 网络管理

## 进程管理


## shell编程概述和编程基础

## 测试和判断

## 循环

## 函数

## 重定向

## shell脚本范例