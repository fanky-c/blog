---
title: 网络是怎样连接的
date: 2024-05-10 20:52:24
tags:
 - 网络是怎样连接
---

## 1、浏览器生成消息 --- 探索浏览器内部
### 1.1 生成HTTP请求消息
#### 1.1.1 探索之旅从输入网址开始

我们的探索之旅从在浏览器中输入网址开始，在介绍浏览器的工作方式之前，让我们先来介绍一下网址。网址，准确来说应该叫URL，如果我说它就是以http://开头的那一串东西，恐怕大家一下子就明白了，但实际上除了“http:”，网址还可以以其他一些文字开头，例如“ftp:”“file:”“mailto:”等。

现在互联网中常见的几种URL，根据访问目标的不同，URL的写法也会不同。例如在访问Web服务器和FTP服务器时，URL中会包含服务器的域名和要访问的文件的路径名等，而发邮件的URL则包含收件人的邮件地址。此外，根据需要，URL中还会包含用户名、密码、服务器端口号等信息。

<img src="/img/network1.jpg" />

尽管URL有各种不同的写法，但它们有一个共同点，那就是URL开头的文字，即“http:”“ftp:”“file:”“mailto:”这部分文字都表示浏览器应当使用的访问方法。比如当访问Web服务器时应该使用HTTP协议，而访问FTP服务器时则应该使用FTP协议。因此，我们可以把这部分理解为访问时使用的协议类型。尽管后面部分的写法各不相同，但开头部分的内容决定了后面部分的写法，因此并不会造成混乱。


#### 1.1.2 浏览器先要解析URL

浏览器要做的第一步工作就是对URL进行解析，从而生成发送给Web服务器的请求消息。刚才我们已经讲过，URL的格式会随着协议的不同而不同，因此下面我们以访问Web服务器的情况为例来进行讲解。

<img src="/img/network2.jpg" />


#### 1.1.3 省略文件名的情况

没有文件名，服务器怎么知道要访问哪个文件呢？其实，我们会在服务器上事先设置好文件名省略时要访问的默认文件名。这个设置根据服务器不同而不同，大多数情况下是index.html或者default.htm之类的文件名。因此，像前面这样省略文件名时，服务器就会访问/dir/index.html或者/dir/default.htm。


#### 1.1.4 HTTP的基本思路

<img src="/img/network3.jpg" />

HTTP协议定义了客户端和服务器之间交互的消息内容和步骤，其基本思路非常简单。

首先，客户端会向服务器发送请求消息。请求消息中包含的内容是“对什么”和“进行怎样的操作”两个部分。其中相当于“对什么”的部分称为URI。换句话说就是，这里可以写各种访问目标，而这些访问目标统称为URI。

接下来“进行怎样的操作”的部分称为方法，方法表示需要让Web服务器完成怎样的工作，其中典型的例子包括读取URI表示的数据、将客户端输入的数据发送给URI表示的程序等。

<img src="/img/network4.jpg" />


#### 1.1.5 生成HTTP请求消息

理解了HTTP的基本知识之后，让我们回到对浏览器本身的探索中来。

对URL进行解析之后，浏览器确定了Web服务器和文件名，接下来就是根据这些信息来生成HTTP请求消息了。实际上，HTTP消息在格式上是有严格规定的，因此浏览器会按照规定的格式来生成请求消息。

首先，请求消息的第一行称为请求行。这里的重点是最开头的方法，方法可以告诉Web服务器它应该进行怎样的操作。

HTTP消息的格式如下：

<img src="/img/network5.jpg" />

HTTP中主要头字段如下：

<img src="/img/network6.jpg" />

<img src="/img/network7.jpg" />

#### 1.1.6 发送请求后收到响应

当我们将上述请求消息发送出去之后，Web服务器会返回响应消息。

在响应消息中，第一行的内容为状态码和响应短语，用来表示请求的执行结果是成功还是出错。状态码和响应短语表示的内容一致，但它们的用途不同。状态码是一个数字，它主要用来向程序告知执行的结果；相对地，响应短语则是一段文字，用来向人们告知执行的结果。

<img src="/img/network8.jpg" />

HTTP消息示例如下：

<img src="/img/network9.jpg" />

<img src="/img/network10.jpg" />

<img src="/img/network11.jpg" />

### 1.2 向DNS服务器查询Web服务器IP地址

#### 1.2.1 IP地址的基本知识

生成HTTP消息之后，接下来我们需要委托操作系统将消息发送给Web服务器。尽管浏览器能够解析网址并生成HTTP消息，但它本身并不具备将消息发送到网络中的功能，因此这一功能需要委托操作系统来实现。在进行这一操作时，我们还有一个工作需要完成，那就是查询网址中服务器域名对应的IP地址。在委托操作系统发送消息时，必须要提供的不是通信对象的域名，而是它的IP地址。因此，在生成HTTP消息之后，下一个步骤就是根据域名查询IP地址。

#### 1.2.2 域名和IP地址并用的理由

#### 1.2.3 Socket库提供查询IP地址的功能

#### 1.2.4 通过解析器向DNS服务器发出查询

#### 1.2.5 解析器的内部原理

### 1.3 全世界DNS服务器的大接力

### 1.4 委托协议栈发送消息

## 2、用电信号传输TCP/IP --- 探索协议栈和网卡


## 3、从网络到网络设备 --- 探索集线器、交换机和路由器

## 4、通过接入网进入互联网内部 --- 探索接入网和网络运营商


## 5、服务器端的局域网中有什么玄机

## 6、请求到达web服务器，响应返回浏览器 --- 短短几秒“漫长旅程”迎来终点
